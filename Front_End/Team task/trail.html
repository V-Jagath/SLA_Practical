<!doctype html>
<html lang="en">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Appointment Booking System</title>
  <script src="/_sdk/data_sdk.js"></script>
  <script src="/_sdk/element_sdk.js"></script>
  <style>
    body {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100%;
      height: 100%;
    }

    html {
      height: 100%;
    }

    .app-container {
      width: 100%;
      min-height: 100%;
      padding: 40px 20px;
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    .content-wrapper {
      width: 100%;
      max-width: 1200px;
    }

    h1 {
      color: #ffffff;
      text-align: center;
      font-size: 2.5em;
      margin-bottom: 10px;
      text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
    }

    .nav-buttons {
      display: flex;
      justify-content: center;
      gap: 15px;
      margin-bottom: 30px;
    }

    .nav-btn {
      background: #ffffff;
      color: #667eea;
      border: none;
      padding: 12px 30px;
      border-radius: 25px;
      font-size: 1em;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      box-shadow: 0 4px 6px rgba(0,0,0,0.1);
    }

    .nav-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 12px rgba(0,0,0,0.15);
    }

    .nav-btn.active {
      background: #764ba2;
      color: #ffffff;
    }

    .page {
      display: none;
    }

    .page.active {
      display: block;
    }

    .form-card {
      background: #ffffff;
      border-radius: 20px;
      padding: 40px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.2);
      max-width: 600px;
      margin: 0 auto;
    }

    h2 {
      color: #667eea;
      text-align: center;
      font-size: 2em;
      margin-bottom: 30px;
    }

    .form-group {
      margin-bottom: 25px;
    }

    label {
      display: block;
      color: #333333;
      font-weight: 600;
      margin-bottom: 8px;
      font-size: 0.95em;
    }

    input[type="text"],
    input[type="tel"],
    input[type="date"],
    select,
    textarea {
      width: 100%;
      padding: 12px 15px;
      border: 2px solid #e0e0e0;
      border-radius: 10px;
      font-size: 1em;
      font-family: inherit;
      transition: border-color 0.3s ease;
      box-sizing: border-box;
    }

    input:focus,
    select:focus,
    textarea:focus {
      outline: none;
      border-color: #667eea;
    }

    textarea {
      resize: vertical;
      min-height: 100px;
    }

    .submit-btn {
      width: 100%;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: #ffffff;
      border: none;
      padding: 15px;
      border-radius: 10px;
      font-size: 1.1em;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      margin-top: 10px;
    }

    .submit-btn:hover:not(:disabled) {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);
    }

    .submit-btn:disabled {
      opacity: 0.6;
      cursor: not-allowed;
    }

    .error-message {
      background: #ff4444;
      color: #ffffff;
      padding: 15px;
      border-radius: 10px;
      margin-bottom: 20px;
      display: none;
      text-align: center;
      font-weight: 600;
    }

    .error-message.show {
      display: block;
    }

    .success-message {
      background: #4caf50;
      color: #ffffff;
      padding: 15px;
      border-radius: 10px;
      margin-bottom: 20px;
      display: none;
      text-align: center;
      font-weight: 600;
    }

    .success-message.show {
      display: block;
    }

    .appointments-container {
      background: #ffffff;
      border-radius: 20px;
      padding: 40px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.2);
    }

    .appointments-table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
    }

    .appointments-table th {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: #ffffff;
      padding: 15px;
      text-align: left;
      font-weight: 600;
    }

    .appointments-table td {
      padding: 15px;
      border-bottom: 1px solid #e0e0e0;
      color: #333333;
    }

    .appointments-table tr:hover {
      background: #f5f5f5;
    }

    .delete-btn {
      background: #ff4444;
      color: #ffffff;
      border: none;
      padding: 8px 16px;
      border-radius: 5px;
      cursor: pointer;
      font-size: 0.9em;
      transition: background 0.3s ease;
    }

    .delete-btn:hover:not(:disabled) {
      background: #cc0000;
    }

    .delete-btn:disabled {
      opacity: 0.6;
      cursor: not-allowed;
    }

    .no-appointments {
      text-align: center;
      color: #666666;
      padding: 40px;
      font-size: 1.1em;
    }

    .loading {
      text-align: center;
      color: #667eea;
      padding: 20px;
      font-size: 1em;
    }

    @media (max-width: 768px) {
      .form-card, .appointments-container {
        padding: 25px;
      }

      h1 {
        font-size: 2em;
      }

      h2 {
        font-size: 1.5em;
      }

      .appointments-table {
        font-size: 0.9em;
      }

      .appointments-table th,
      .appointments-table td {
        padding: 10px;
      }
    }
  </style>
  <style>@view-transition { navigation: auto; }</style>
  <script src="https://cdn.tailwindcss.com" type="text/javascript"></script>
 </head>
 <body>
  <div class="app-container">
   <div class="content-wrapper">
    <h1 id="pageTitle">Appointment Booking System</h1>
    <div class="nav-buttons"><button class="nav-btn active" onclick="showPage('booking')">Book Appointment</button> <button class="nav-btn" onclick="showPage('list')">View Appointments</button>
    </div><!-- Booking Form Page -->
    <div id="bookingPage" class="page active">
     <div class="form-card">
      <h2 id="formHeading">Book Your Appointment</h2>
      <div id="errorMessage" class="error-message"></div>
      <div id="successMessage" class="success-message"></div>
      <form id="bookingForm">
       <div class="form-group"><label for="fullName">Full Name *</label> <input type="text" id="fullName" name="fullName" required>
       </div>
       <div class="form-group"><label for="phoneNumber">Phone Number *</label> <input type="tel" id="phoneNumber" name="phoneNumber" required>
       </div>
       <div class="form-group"><label for="appointmentDate">Date *</label> <input type="date" id="appointmentDate" name="appointmentDate" required>
       </div>
       <div class="form-group"><label for="timeSlot">Time Slot *</label> <select id="timeSlot" name="timeSlot" required> <option value="">Select a time slot</option> <option value="10AM">10AM</option> <option value="11AM">11AM</option> <option value="12PM">12PM</option> <option value="4PM">4PM</option> <option value="5PM">5PM</option> </select>
       </div>
       <div class="form-group"><label for="reason">Reason for Visit *</label> <textarea id="reason" name="reason" required></textarea>
       </div><button type="submit" class="submit-btn" id="submitBtn">Book Appointment</button>
      </form>
     </div>
    </div><!-- Appointments List Page -->
    <div id="listPage" class="page">
     <div class="appointments-container">
      <h2 id="listHeading">All Appointments</h2>
      <div id="appointmentsContent">
       <div class="loading">
        Loading appointments...
       </div>
      </div>
     </div>
    </div>
   </div>
  </div>
  <script>
    let appointments = [];
    let currentPage = 'booking';

    const defaultConfig = {
      page_title: "Appointment Booking System",
      form_heading: "Book Your Appointment",
      list_heading: "All Appointments",
      background_color: "#667eea",
      card_background: "#ffffff",
      primary_button_color: "#667eea",
      text_color: "#333333",
      font_family: "Segoe UI",
      font_size: 16
    };

    // Data SDK Handler
    const dataHandler = {
      onDataChanged(data) {
        appointments = data;
        renderAppointmentsList();
      }
    };

    // Initialize Data SDK
    async function initDataSdk() {
      const result = await window.dataSdk.init(dataHandler);
      if (!result.isOk) {
        console.error("Failed to initialize Data SDK");
      }
    }

    // Element SDK Functions
    async function onConfigChange(config) {
      const pageTitle = document.getElementById('pageTitle');
      const formHeading = document.getElementById('formHeading');
      const listHeading = document.getElementById('listHeading');

      if (pageTitle) pageTitle.textContent = config.page_title || defaultConfig.page_title;
      if (formHeading) formHeading.textContent = config.form_heading || defaultConfig.form_heading;
      if (listHeading) listHeading.textContent = config.list_heading || defaultConfig.list_heading;

      const appContainer = document.querySelector('.app-container');
      if (appContainer) {
        appContainer.style.background = `linear-gradient(135deg, ${config.background_color || defaultConfig.background_color} 0%, ${config.primary_button_color || defaultConfig.primary_button_color} 100%)`;
      }

      const customFont = config.font_family || defaultConfig.font_family;
      const baseFontStack = 'Tahoma, Geneva, Verdana, sans-serif';
      document.body.style.fontFamily = `${customFont}, ${baseFontStack}`;

      const baseSize = config.font_size || defaultConfig.font_size;
      const h1Elements = document.querySelectorAll('h1');
      h1Elements.forEach(el => el.style.fontSize = `${baseSize * 2.5}px`);
      const h2Elements = document.querySelectorAll('h2');
      h2Elements.forEach(el => el.style.fontSize = `${baseSize * 2}px`);
      document.body.style.fontSize = `${baseSize}px`;
    }

    function mapToCapabilities(config) {
      return {
        recolorables: [
          {
            get: () => config.background_color || defaultConfig.background_color,
            set: (value) => {
              if (window.elementSdk) {
                window.elementSdk.setConfig({ background_color: value });
              }
            }
          },
          {
            get: () => config.card_background || defaultConfig.card_background,
            set: (value) => {
              if (window.elementSdk) {
                window.elementSdk.setConfig({ card_background: value });
              }
            }
          },
          {
            get: () => config.text_color || defaultConfig.text_color,
            set: (value) => {
              if (window.elementSdk) {
                window.elementSdk.setConfig({ text_color: value });
              }
            }
          },
          {
            get: () => config.primary_button_color || defaultConfig.primary_button_color,
            set: (value) => {
              if (window.elementSdk) {
                window.elementSdk.setConfig({ primary_button_color: value });
              }
            }
          }
        ],
        borderables: [],
        fontEditable: {
          get: () => config.font_family || defaultConfig.font_family,
          set: (value) => {
            if (window.elementSdk) {
              window.elementSdk.setConfig({ font_family: value });
            }
          }
        },
        fontSizeable: {
          get: () => config.font_size || defaultConfig.font_size,
          set: (value) => {
            if (window.elementSdk) {
              window.elementSdk.setConfig({ font_size: value });
            }
          }
        }
      };
    }

    function mapToEditPanelValues(config) {
      return new Map([
        ["page_title", config.page_title || defaultConfig.page_title],
        ["form_heading", config.form_heading || defaultConfig.form_heading],
        ["list_heading", config.list_heading || defaultConfig.list_heading]
      ]);
    }

    // Initialize Element SDK
    async function initElementSdk() {
      if (window.elementSdk) {
        await window.elementSdk.init({
          defaultConfig,
          onConfigChange,
          mapToCapabilities,
          mapToEditPanelValues
        });
      }
    }

    // Page Navigation
    function showPage(page) {
      currentPage = page;
      document.getElementById('bookingPage').classList.remove('active');
      document.getElementById('listPage').classList.remove('active');
      
      document.querySelectorAll('.nav-btn').forEach(btn => {
        btn.classList.remove('active');
      });

      if (page === 'booking') {
        document.getElementById('bookingPage').classList.add('active');
        document.querySelectorAll('.nav-btn')[0].classList.add('active');
      } else {
        document.getElementById('listPage').classList.add('active');
        document.querySelectorAll('.nav-btn')[1].classList.add('active');
        renderAppointmentsList();
      }
    }

    // Form Submission
    document.getElementById('bookingForm').addEventListener('submit', async (e) => {
      e.preventDefault();

      const submitBtn = document.getElementById('submitBtn');
      const errorMessage = document.getElementById('errorMessage');
      const successMessage = document.getElementById('successMessage');

      errorMessage.classList.remove('show');
      successMessage.classList.remove('show');

      const formData = {
        full_name: document.getElementById('fullName').value,
        phone_number: document.getElementById('phoneNumber').value,
        appointment_date: document.getElementById('appointmentDate').value,
        time_slot: document.getElementById('timeSlot').value,
        reason: document.getElementById('reason').value,
        created_at: new Date().toISOString()
      };

      // Check if slot is already booked
      const isSlotTaken = appointments.some(apt => 
        apt.appointment_date === formData.appointment_date && 
        apt.time_slot === formData.time_slot
      );

      if (isSlotTaken) {
        errorMessage.textContent = "This slot is already booked. Please choose another time.";
        errorMessage.classList.add('show');
        return;
      }

      // Check limit
      if (appointments.length >= 999) {
        errorMessage.textContent = "Maximum limit of 999 appointments reached. Please delete some appointments first.";
        errorMessage.classList.add('show');
        return;
      }

      submitBtn.disabled = true;
      submitBtn.textContent = "Booking...";

      const result = await window.dataSdk.create(formData);

      submitBtn.disabled = false;
      submitBtn.textContent = "Book Appointment";

      if (result.isOk) {
        successMessage.textContent = "Appointment booked successfully!";
        successMessage.classList.add('show');
        document.getElementById('bookingForm').reset();
        
        setTimeout(() => {
          successMessage.classList.remove('show');
        }, 3000);
      } else {
        errorMessage.textContent = "Failed to book appointment. Please try again.";
        errorMessage.classList.add('show');
      }
    });

    // Render Appointments List
    function renderAppointmentsList() {
      const content = document.getElementById('appointmentsContent');
      
      if (appointments.length === 0) {
        content.innerHTML = '<div class="no-appointments">No appointments booked yet.</div>';
        return;
      }

      const sortedAppointments = [...appointments].sort((a, b) => {
        return new Date(a.appointment_date) - new Date(b.appointment_date);
      });

      let html = `
        <table class="appointments-table">
          <thead>
            <tr>
              <th>Name</th>
              <th>Phone</th>
              <th>Date</th>
              <th>Time</th>
              <th>Reason</th>
              <th>Action</th>
            </tr>
          </thead>
          <tbody>
      `;

      sortedAppointments.forEach(apt => {
        const date = new Date(apt.appointment_date);
        const formattedDate = date.toLocaleDateString('en-US', { 
          year: 'numeric', 
          month: 'short', 
          day: 'numeric' 
        });

        html += `
          <tr data-id="${apt.__backendId}">
            <td>${apt.full_name}</td>
            <td>${apt.phone_number}</td>
            <td>${formattedDate}</td>
            <td>${apt.time_slot}</td>
            <td>${apt.reason}</td>
            <td>
              <button class="delete-btn" onclick="deleteAppointment('${apt.__backendId}')">Delete</button>
            </td>
          </tr>
        `;
      });

      html += '</tbody></table>';
      content.innerHTML = html;
    }

    // Delete Appointment
    async function deleteAppointment(backendId) {
      const appointment = appointments.find(apt => apt.__backendId === backendId);
      if (!appointment) return;

      const row = document.querySelector(`tr[data-id="${backendId}"]`);
      const deleteBtn = row.querySelector('.delete-btn');
      
      deleteBtn.disabled = true;
      deleteBtn.textContent = "Deleting...";

      const result = await window.dataSdk.delete(appointment);

      if (!result.isOk) {
        deleteBtn.disabled = false;
        deleteBtn.textContent = "Delete";
        alert("Failed to delete appointment. Please try again.");
      }
    }

    // Set minimum date to today
    const today = new Date().toISOString().split('T')[0];
    document.getElementById('appointmentDate').setAttribute('min', today);

    // Initialize both SDKs
    initDataSdk();
    initElementSdk();
  </script>
 <script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9a39cc7235466ee0',t:'MTc2Mzk5NjY2NS4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>